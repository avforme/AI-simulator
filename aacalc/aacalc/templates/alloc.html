{% extends "base.html" %}

{% comment %}

AACalc - Asset Allocation Calculator
Copyright (C) 2009, 2011-2018 Gordon Irlam

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

{% endcomment %}

{% block title %}Asset allocation calculator{% endblock %}

{% block head %}
{% if mode == 'aa' %}
<meta name="description" content="Computes asset allocation, income annuitization, and consumption using scientific principles. And explains how the recommendations were derived." /><!-- Keep content to less than 155 characters according to Wikipedia. -->
{% elif mode == 'number' %}
<meta name="description" content="Computes your retirement number using scientific principles. And explains how your number was derived." />
{% else %}
<meta name="description" content="Using scientific principles computes the age you can expect to retire. And explains how the results were derived." />
{% endif %}
<script type="text/javascript" src="/static/js/jquery-1.10.2.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){
    // Handle page reloads, button state may be remembered by browser but show/hide are not.
    $('.advanced_button:checked').closest('.simple_advanced').find('.advanced,.simple').toggle();
    $('.advanced_button').click(function() {
        $(this).closest('.simple_advanced').find('.advanced,.simple').toggle();
    });

    e = document.getElementById("results");
    if (e)
         e.scrollIntoView();
});
</script>
{% endblock %}

{% block content %}

{% if mode == 'aa' %}
<h1>Asset allocation calculator</h1>
{% elif mode == 'number' %}
<h1>Retirement Age Calculator</h1>
{% else %}
<h1>Retirement Number Calculator</h1>
{% endif %}

<p>
<img style="float: right; margin-left: 10px;" width=400 height=200 src="/static/images/shutterstock_69970861.jpg" alt="golden egg">
</p>

{% if mode == 'aa' %}
This calculator computes asset allocations, income annuitization,
reverse mortgages, and consumption using scientific
principles. And it explains how the recommendations were derived.
{% elif mode == 'number' %}
This calculator computes the financial position you need to be in for
retirement using scientific principles. And it explains how your
number was derived.
{% else %}
Using scientific principles this calculator computes the age at which
your pre-retirment contributions should be sufficient to meet your
retirement needs. And it explains how the results were derived.
{% endif %}

<br />
<br />

This calculator does not include a questionnaire on risk tolerance
(your psychological ability to stomach investment losses). Instead it
primarily concerned with computing the appropriate strategy given your risk
aversion (preference for uniform consumption).

<br />
<br />

Several things set this calculator apart:

<ul>

<li> A balance sheet approach - asset allocation can't be performed in
isolation, but must be performed by taking into account the presence
and size of Social Security, Pensions, 401(k)'s, income annuities, and
home equity. See the <a href="{% url 'docs' 'faq' %}">FAQ</a> for more
details.</li>

{% if mode != 'number' %}
<li> Future contributions - the impact of any possible future
contributions is handled by entering their expected annual amount,
growth rate, and volatility. </li>
{%endif %}

<li> A true risk free asset - liability matching bonds, that is
inflation indexed zero coupon bonds with a duration matching that of
anticipated retirement cash flows, not cash, are used as the true risk
free asset. Liability matching bonds might be hard to purchase, but a
TIPS ladder, or a TIPS bond fund of appropriate duration, is a close
substitute. </li>

<li> Income annuities - income annuities are a valuable tool in the
retirement toolbox. This calculator optionally recommends the
purchase of inflation indexed income annuities, be they single premium
immediate annuities or deferred income annuities. </li>

<li> Home equity - home equity is the largest asset class for many
individuals.  It is thus important to consider the appropriate role of
home equity in the retirement planning process. </li>

<li> Admit what we don't know - returns from the stock market are
intrinsically unknown. We generate a range of results for different
plausible scenarios. </li>

<li> Cross validated - sample Merton's method recommendations produced
by this calculator have been
<a href="{% url 'docs' 'validation' %}">cross validated</a> with a
second asset allocator that uses stochastic dynamic programming. </li>

<li> Open source - available under a GNU Affero license on
GitHub: <a href="https://github.com/gordoni/aacalc">https://github.com/gordoni/aacalc</a> </li>

</ul>

<div style="clear: both;"></div>

<form  method="post">
{% csrf_token %}

{% if errors_present %}
<div class="errorlist">
Please correct the errors in red below:
</div>
{{ alloc_form.non_field_errors }}
{% endif %}

<h2>Longevity</h2>

<div class="indent">

Sex: {{ alloc_form.sex }}
Age: {{ alloc_form.age }}
{{ alloc_form.sex.errors }}
{{ alloc_form.age.errors }}
<br />
Spouse/partner: {{ alloc_form.sex2 }}
Age: {{ alloc_form.age2 }}
{{ alloc_form.sex2.errors }}
{{ alloc_form.age2.errors }}

<br />
<br />

Total life expectancy for self (if known) <a title="Enter total life expectancy (age at death) for self, and spouse if relevant. We use the Social Security AS 120 cohort life tables for males and females as a base and then applies an adjustment factor to the probability of death values so that the adjusted table life expectancies match the specified total life expectancy. If these fields are left blank, life expectancy will be based on U.S. Social Security projections for the U.S. general population for the specified sex."><img src="/static/images/Information-icon.png" alt="[?]"></a>: {{ alloc_form.le_set }} Spouse: {{ alloc_form.le_set2 }}
{{ alloc_form.le_set.errors }}
{{ alloc_form.le_set2.errors }}
<div class="small">
Enter your total life expectancy if known, or leave blank to have your
life expectancy computed using U.S. Social Security Administration
data.
</div>

</div>

<h2>Financial position</h2>

<div class="indent">

<div class="small">
This section highlights the balance sheet nature of the approach used. Any asset can essentially be thought of as a series of future cash flows that may be certain or uncertain to some degree. This is true not only of the future cash flows from stocks and bonds, but also such items as future Social Security or pension payments as well as future contributions to retirement savings.
</div>

<br />

Existing defined benefits:

<br />
<br />

<div class="indent">

{{ alloc_form.db.management_form }}
<table class="table-lined center">
<tr>
<td> </td>
<td> Owner <br /> self/spouse </td>
<td> Starting age </td>
<td> Annual amount </td>
<td> Inflation indexed </td>
<td> Death benefit <br /> Contingent/survivor payout </td>
</tr>
{% for db in alloc_form.db %}
<tr>
<td>
{{ db.social_security }}
{% if db.social_security.value == True %}
Social Security
{% else %}
{% if db.social_security.value == 'True' %}
{% comment %} Django goofyness on a bound form {% endcomment %}
Social Security
{% else %}
{{ db.description }}
{% endif %}
{% endif %}
</td>
<td> {{ db.who }} </td>
<td> {{ db.age }} </td>
<td> {{ db.amount }} </td>
<td> {{ db.inflation_indexed }} </td>
<td> {{ db.joint_type }} {{ db.joint_payout_pct }}% </td>
</tr>
<tr>
<td colspan=6 class="left">
{{ db.social_secuity.errors }}
{% if db.social_security.value == True %}
{% else %}
{% if db.social_security.value == 'True' %}
{% else %}
{{ db.description.errors }}
{% endif %}
{% endif %}
{{ db.who.errors }}
{{ db.age.errors }}
{{ db.amount.errors }}
{{ db.inflation_indexed.errors }}
{{ db.joint_type.errors }}
{{ db.joint_payout_pct.errors }}
{{ db.non_field_errors }}
</td>
</tr>
{% endfor %}
<tr>
<td colspan=7 class="small left">
Reverse mortgage is for a reverse mortgage providing a fixed annual income (tenure) only.
Starting age is that of the owner. Annual amount is in current inflation-adjusted
after tax dollars, not future dollars. For income annuities, which become fully
taxable after a certain age, enter the expected average after tax amount.
Payouts last at least as long as the owner's life.
Contingent: payout reduced on death of either party.
Survivor: payout reduced only on death of the owner.
</td>
</tr>
</table>

</div>

{% if mode != 'number' %}

<br />

Existing defined contribution savings:

<br />
<br />

<div class="indent">

Pre-tax traditional IRAs, 401(k)'s, 403(b)'s, and 457's size: {{ alloc_form.p_traditional_iras }}
Tax rate: {{ alloc_form.tax_rate_pct }}%
{{ alloc_form.p_traditional_iras.errors }}
{{ alloc_form.tax_rate_pct.errors }}
<br />
After tax Roth IRAs, 401(k)'s, and 403(b)'s size: {{ alloc_form.p_roth_iras }}
{{ alloc_form.p_roth_iras.errors }}
<br />
Taxable retirement savings size: {{ alloc_form.p }}
{{ alloc_form.p.errors }}
<div class="small">
Variable annuities are not recommended as an investment
vehicle, but during the accumulation phase principal spent purchasing
variable annuities should be handled similarly to after tax investments
and earnings on variable annuities should be handled similarly to
pre-tax investments. During the payout phase variable annuities are
best listed, albeit imprecisely, under defined benefits.
</div>
<br />
Pre-retirement annual contribution amount after tax (irrelevant if retired):
{{ alloc_form.contribution }}
{{ alloc_form.contribution.errors }}
<br />
Reduction in contribution amount when only one spouse is working:
{{ alloc_form.contribution_reduction }}
{{ alloc_form.contribution_reduction.errors }}
<br />
Real growth rate: {{ alloc_form.contribution_growth_pct }}%
Annual volatility: {{ alloc_form.contribution_vol_pct }}%
{{ alloc_form.contribution_growth_pct.errors }}
{{ alloc_form.contribution_vol_pct.errors }}
<div class="small">
Contributions and mortgage payments (below) are combined on the
assumption that once the mortgage is paid off the additional funds
will go towards retirement savings. Contribution amount should consist
only of new money contributed to your retirement savings, not the
payout from any existing pre-retirement defined benefits. Reduction
when only one spouse is working will normally equal the after tax
income of the retired spouse, should be expressed prior to applying
any growth rate, and can exceed the contribution amount if drawdown is
then occuring. A growth
rate of 5% represents a doubling every 14 years.
Remember to take into account life events such as promotions, or
children leaving home in estimating the growth rate.
</div>

</div>

{% endif %}

<br />

Other assets and liabilities:

<br />
<br />

<div class="indent">

Home appraised value: {{ alloc_form.home }}
Real growth rate: {{ alloc_form.home_ret_pct }}%
Volatility: {{ alloc_form.home_vol_pct }}%
{{ alloc_form.home.errors }}
{{ alloc_form.home_ret_pct.errors }}
{{ alloc_form.home_vol_pct.errors }}
<br />
Mortgage balance: {{ alloc_form.mortgage }}
Annual payment: {{ alloc_form.mortgage_payment }}
Fixed APR: {{ alloc_form.mortgage_rate_pct }}%
{{ alloc_form.mortgage.errors }}
{{ alloc_form.mortgage_payment.errors }}
{{ alloc_form.mortgage_rate_pct.errors }}
<br />
Existing reverse mortgage: {{ alloc_form.have_rm }}
<div class="indent">
Unused available credit line: {{ alloc_form.rm_loc }}
</div>
{{ alloc_form.rm_have.errors }}
{{ alloc_form.rm_loc.errors }}
<div class="small">
Mortgage balance should include the mortgage balance of any existing
reverse mortgage, in which case the annual payment will normally be
zero and the APR value used is irrelevant.
</div>

</div>

</div>

<h2>Financial goals</h2>

<div class="indent">

{% if mode != 'retire' %}
Age of primary person at their retirement: {{ alloc_form.retirement_age }}
{{ alloc_form.retirement_age.errors }}
<br />
{% endif %}
Age of spouse at their retirement (blank to retire at the same time as you):
{{ alloc_form.retirement_age2 }}
{{ alloc_form.retirement_age2.errors }}
<br />
Relative income required when one party deceased: {{ alloc_form.joint_income_pct }}%
{{ alloc_form.joint_income_pct.errors }}
<br />
{% if mode == 'aa' %}
<br />
Do not enter desired consumption. This calculator computes the optimal
consumption amount.
<div class="indent">
Optional annual retirement consumption at which you have "lost the game": {{ alloc_form.needed_income }}
{{ alloc_form.needed_income.errors }}
<div class="small">
Losing the game means having an unbearably low level of consumption.
Safe assets (liability matching bonds or possibly income annuities) are allocated to try and ensure consumption never falls
below this level. If the user does not have enough safe assets to
insure the needed consumption level, the program will first reduce
regular bond holdings and substitute safe assets, and then if that
proves insufficient stock holdings will be reduced. Retirement
consumption should be expressed in
current inflation-indexed dollars. Normally you don't need to specify
a value here as the right thing to do will be determined based on your
risk aversion which is specified later. Specifying a value here will
potentially override the impact of the risk aversion coefficient and
directly dictate the asset allocation.
</div>
Optional annual retirement consumption at which you have "won the game": {{ alloc_form.desired_income }}
{{ alloc_form.desired_income.errors }}
<div class="small">
Winning the game means having retirement consumption that meets your
required and desired expenses.  Assets required to support consumption
beyond this level will be allocated to stocks. Retirement consumption
should be expressed in current inflation-indexed dollars. Normally you
don't need to specify a value here as the right thing to do will be
determined based on your risk aversion which is specified later.
Specifying a value here will potentially override the impact of the
risk aversion coefficient and directly dictate the asset allocation.
</div>
</div>
{% else %}
Annual desired retirement consumption level: {{ alloc_form.required_income }}
{{ alloc_form.required_income.errors }}
<div class="small">
Retirement consumption should be expressed in current
inflation-indexed dollars.
</div>
{% endif %}
<br />
Use liability matching bonds <a title="It is useful to note the differences between regular bonds and liability matching bonds. Liability matching bonds reflect the current real yield curve, so there is no option to change the return assumption for such bonds. Liability matching bonds are typically long duration because they are intended to match long-term liabilities (future retirement withdrawals), and therefore such bonds may exhibit significant short-term volatility, making them unattractive to investors with a low risk tolerance. Note that this is an issue dealing with risk tolerance and not risk aversion -- two concepts explained later.

Regular bonds allow input flexibility for both return and volatility. For example, for a user with low risk tolerance, it may make sense to utilize short-term regular bonds as an asset class to keep volatility down. This can be accomplished by adjusting the default return and volatility parameters downward to reflect expectations for shorter-term bonds."><img src="/static/images/Information-icon.png" alt="[?]"></a>: {{ alloc_form.use_lm_bonds }}
{{ alloc_form.use_lm_bonds.errors }}
<div class="small">
Inflation-indexed liability matching bonds are a valuable retirement
planning tool. However the short term volatility of long duration
liability matching bonds may make them unattractive to investors with
a low risk tolerance. If liability matching bonds are not used we
naively replace them with regular bonds.
</div>
<br />
Permit recommendation of income annuities <a title="Unlike investing in stocks and bonds, the purchase of income annuities requires an irreversible commitment. Therefore the program does not recommend annuity purchase unless there is both a clear advantage of increased consumption and a clear advantage for purchasing “now” versus waiting a year. 

Annuitization is evaluated as a second separate pass over the input data, and is only recommended if the expected consumption amount is at least 4% higher than without annuitizing, and the estimated lifetime cost of delaying the decision by one year is more than 0.1% of the potential income annuity purchase amount.

These are the rules for what annuitization looks like: Stocks get annuitized linearly from age 65 to 90, regular bonds get annuitized linearly from 30 to 60, and liability matching bonds get 100% annuitized if the user is older than a specific age between 40 and 50 (depending on retirement age between 50 and 70), otherwise they get 0%. The choice of ages reflects rough judgement about returns from stocks and bonds versus annuity returns including mortality credits."><img src="/static/images/Information-icon.png" alt="[?]"></a>: {{ alloc_form.purchase_income_annuity }}
{{ alloc_form.purchase_income_anuity.errors }}
<div class="small">
Income annuities only make sense if you are in reasonable health and
are not planning on leaving an estate.
</div>
<br />
Permit recommendation of a variable rate reverse mortgage:
{{ alloc_form.use_rm }}
{{ alloc_form.use_rm.errors }}
<div class="small">
Reverse mortgages only make sense if you are not planning on leaving
an estate. Many retirees use home equity as a last resort to pay for
long term care. If you elect to consider a reverse mortgage you should
make sure you either have long term care insurance, or that you still
have sufficient assets to pay for your long term care needs.
</div>
<div class="indent">
<br />
Reverse mortgage lender's margin: {{ alloc_form.rm_margin_pct }}%
{{ alloc_form.rm_margin_pct.errors }}
<br />
Reverse mortgage origination fee and closing costs (excluding MIP):
{{ alloc_form.rm_cost }}
{{ alloc_form.rm_cost.errors }}
<div class="small">
The values used above are merely intended to get you started. If you
are serious about taking out a reverse mortgage you should set these
values based on actual quotes.
</div>
Expected premium of adjustable rate over 1-year CMT rates:
{{ alloc_form.rm_interest_rate_premium_pct }}%
{{ alloc_form.rm_interest_rate_premium_pct.errors }}
<div class="small">
Average values for 1989-2015 are -0.2% for adjustable 1-month CMT,
0.0% for 1-year CMT, 0.1% for 1-month LIBOR, and 0.6% for 12-month
LIBOR rates.
</div>
<br />
For a HECM style reverse mortgage you should leave the following
parameters alone.
<br />
<br />
Required age (of younger spouse) when plan to take reverse mortgage:
{{ alloc_form.rm_age }}
{{ alloc_form.rm_age.errors }}
<br />
Age limit for computing tenure duration:
{{ alloc_form.rm_tenure_limit }}
{{ alloc_form.rm_tenure_limit.errors }}
<br />
Minimum tenure duration:
{{ alloc_form.rm_tenure_duration }}
{{ alloc_form.rm_tenure_duration.errors }}
<br />
Maximum home value eligible for a reverse mortgage:
{{ alloc_form.rm_eligible }}
{{ alloc_form.rm_eligible.errors }}
<br />
Delay in years until obtain reverse mortgage (blank to optimize):
{{ alloc_form.rm_delay }}
{{ alloc_form.rm_delay.errors }}
<br />
Principal limit factor (blank to use 2017 HECM table):
{{ alloc_form.rm_plf }}
{{ alloc_form.rm_plf.errors }}
<br />
Expected average interest rate (blank to use projected 10-year CMT):
{{ alloc_form.rm_interest_rate_pct }}%
{{ alloc_form.rm_interest_rate_pct.errors }}
<br />
Initial mortgage insurance premium:
{{ alloc_form.rm_insurance_initial_pct }}%
Ongoing premium:
{{ alloc_form.rm_insurance_annual_pct }}%
{{ alloc_form.rm_insurance_initial_pct.errors }}
{{ alloc_form.rm_insurance_annual_pct.errors }}
<div class="small">
For a HECM reverse mortgage the index interest rate should be the 10-year
constant maturity Treasury or 10-year LIBOR swap rate.  This is true
even though you will have a monthly or annually adjusting reverse
mortgage.
</div>
</div>
<br />
We do not support the ability to leave a specific bequest amount.

</div>

<h2>Market parameters</h2>

<div class="indent">

You can probably leave the parameters in this section alone.

<br />
<br />

Estimated equity arithmetic real return: {{ alloc_form.equity_ret_pct }}%
Volatility: {{ alloc_form.equity_vol_pct }}%
{{ alloc_form.equity_ret_pct.errors }}
{{ alloc_form.equity_vol_pct.errors }}
<div class="small">
U.S. market average values for 1927-2016 are 8.7% and 19.4%.
World market average values for 1900-2000 are 7.2% and 17.0%.
Going
forward <a href="http://www.advisorperspectives.com/newsletters12/Jeremy_Siegel_Rob_Arnott_and_Other_Experts_Forecast_Equity_Returns.php">many
experts</a> predict lower U.S. stock market returns.
</div>
<br />
Estimated regular bonds premium over 10 year Treasury: {{ alloc_form.bonds_premium_pct }}%
{{ alloc_form.bonds_premium_pct.errors }}
<br />
Estimated regular bonds real volatility: {{ alloc_form.bonds_vol_pct }}%
{{ alloc_form.bonds_vol_pct.errors }}
<br />
Projected long-term inflation rate: {{ alloc_form.inflation_pct }}%
{{ alloc_form.inflation_pct.errors }}
<div class="small">
Estimated premium of an average bond portfolio over 10 year constant
maturity Treasuries is 0.6%.  Estimated U.S. bond market average real
volatility for 1927-2016 was 8.7%. Survey of Professional Forecasters
2017Q1 10 year inflation rate was 2.3%.
<br />
<br />
<div class="bold">
Using the default parameters no regular bonds may be recommended. This
will occur if regular bonds have a lower expected return than zero
long-term volatility inflation indexed liability matching bonds.
</div>
</div>
<br />
Correlation of equity returns with bonds: {{ alloc_form.equity_bonds_corr_pct }}%
{{ alloc_form.equity_bonds_corr_pct.errors }}
<div class="small">
Estimated U.S. market average value for 1927-2016 is 7.3%.
</div>
<br />
Real volatility of 10 year inflation-indexed zero coupon bonds:
{{ alloc_form.real_vol_10yr_pct }}%
{{ alloc_form.real_vol_10yr_pct.errors }}
<br />
Correlation with regular bonds: {{ alloc_form.bonds_lm_bonds_corr_short_pct }}%
{{ alloc_form.bonds_lm_bonds_corr_short_pct.errors }}
<div class="small">
Synthetic historical values for 1972-2016 for coupon bonds are 4.8%
and 23.9%. Zero coupon bonds will be similar.
</div>
<br />
Standard error of estimate of equity real return <a title="This parameter recognizes the uncertainty associated with the estimated equity arithmetic real return. Virtually all financial planning software programs make the artificial assumption that the future average equity return is known with certainty. This program recognizes additional uncertainty about equity returns -- not only do year-to-year equity returns fluctuate around the mean value, but the mean value itself is only an estimate that involves uncertainty. Incorporating this additional uncertainty provides more appropriate recognition of the risks involved in equity investing."><img src="/static/images/Information-icon.png" alt="[?]"></a>: {{ alloc_form.equity_se_pct }}%
{{ alloc_form.equity_se_pct.errors }}
<div class="small">
U.S. market average value for 1927-2016 is 2.0%.
World market average value for 1900-2000 is 1.7%.
<!--
U.S. market average value for 1900-2000 is 2.0% stocks relative to nominal long bonds.
World market average value for 1900-2000 is 1.4% stocks relative to nominal long bonds.
-->
</div>
Also report results forming a {{ alloc_form.confidence_pct }}%
confidence interval for the equity return.
{{ alloc_form.confidence.errors }}
<br />
<br />
Equity and regular bond management fee: {{ alloc_form.expense_pct }}%
{{ alloc_form.expense_pct.errors }}
<div class="small">
A value around 0.1% is typical for a low cost provider such
as <a href="http://www.vanguard.com/">Vanguard</a>.
</div>

<br />

Real interest rate: {{ alloc_form.real_rate_pct }}%
{{ alloc_form.real_rate_pct.errors }}
<br />
Yield curve date: {{ alloc_form.date }}
{{ alloc_form.date.errors }}
<div class="small">
Fixed interest rates can be specified, or if left blank the Treasury
yield curves for the specified date will be used. When a fixed real
rate is used a fixed nominal rate is formed by combing the fixed real
rate, the projected inflation rate, and the regular bonds premium.
</div>

</div>

<h2>Well being</h2>

<div class="indent">

Coefficient of relative risk aversion, &gamma;: {{ alloc_form.gamma }}
{{ alloc_form.gamma.errors }}
<div class="small">
This determines how risk averse you are. A value such as 1 represents
a low degree of risk aversion and favors stocks. A value such as 5
represents a high degree of risk aversion and favors bonds. Risk
aversion is not the same as risk tolerance.  Risk tolerance is about
how psychologically comfortable you are with losses to your investment
assets. Risk aversion is about how you feel about a change in your
annual consumption.
<a href="{% url 'docs' 'relative_risk_aversion' %}">Economists are
divided on an appropriate value for &gamma;</a>. Many think it is in
the range 1 to 4. Others consider a value
of 10 or even higher reasonable. Marginal utility of consumption,
U'(C) = C<sup>-&gamma;</sup>.
<br />
<br />
This is a difficult concept. We present multiple tables to help you
get this important parameter right.
<br />
<br />
<table class="table-lined center">
<tr>
<td colspan=6> As &gamma; increases the desirability of risk taking decreases. </td>
</tr>
<tr>
<td> &gamma; </td>
<td> 1 </td>
<td> 2 </td>
<td> 3 </td>
<td> 4 </td>
<td> 5 </td>
</tr>
<tr>
<td class="left"> Indifference to a 50/50 chance of consuming either 100% of C or 200%
<br /> of C versus consuming the guaranteed fixed percentage of C shown </td>
<td> 141% </td>
<td> 133% </td>
<td> 126% </td>
<td> 121% </td>
<td> 117% </td>
</tr>
</table>
<br />
<table class="table-lined center">
<tr>
<td colspan=6> The value of an additional dollar declines as you consume more. </td>
</tr>
<tr>
<td> &gamma; </td>
<td> 1 </td>
<td> 2 </td>
<td> 3 </td>
<td> 4 </td>
<td> 5 </td>
</tr>
<tr>
<td class="left"> Value of an additional dollar when consuming 110% of C compared
<br> to the value of an additional dollar when consuming 100% of C </td>
<td> 91% </td>
<td> 83% </td>
<td> 75% </td>
<td> 68% </td>
<td> 62% </td>
</tr>
</table>
<br />
<table class="table-lined center">
<tr>
<td colspan=6> The value of an additional dollar declines rapidly for high consumption levels. </td>
</tr>
<tr>
<td> &gamma; </td>
<td> 1 </td>
<td> 2 </td>
<td> 3 </td>
<td> 4 </td>
<td> 5 </td>
</tr>
<tr>
<td class="left"> Value of an additional dollar when consuming 200% of C compared
<br> to the value of an additional dollar when consuming 100% of C </td>
<td> 50% </td>
<td> 25% </td>
<td> 13% </td>
<td> 6% </td>
<td> 3% </td>
</tr>
</table>
</div>

<br />

Risk tolerance: 10% annual chance of experiencing real investment
portfolio losses of {{ alloc_form.risk_tolerance_pct }}% or more.
{{ alloc_form.risk_tolerance_pct.errors }}
<div class="small">
Risk tolerance is concerned with the ability to psychologically handle
losses to your investment portfolio, and not pull out of the market in
the event of a downturn.  Risk tolerance differs from risk aversion by
only looking at investment assets rather than the total portfolio
including defined benefits. Setting it to a low or intermediate value
provides for peace of mind but will reduce your expected
consumption. In an ideal world it might be set as high as possible so
that risk aversion, which looks at the total portfolio, can take over
in determining the appropriate asset allocation. For the default
market parameters a value of 18% or higher effectively imposes no
constraints. Setting it to a value of 10% or less is only possible for
ages above about 40, or if you also alter the default market
parameters to be indicative of shorter-term bonds.
</div>

</div>

<br />

<div class="center">
<input class="button" type="submit" value="Submit" />
{% if mode == 'retire' %}
<div class="small">
takes 5 seconds
</div>
{% endif %}
</div>

{% if results and not errors_present %}

<div id="results">

<br />

<div class="simple_advanced">

<div class="center">

<img src="{{ results.dirurl }}/alloc.png" alt="allocation">

<br />
<br />

<table style="margin: auto;">

<tr>
<td width=50% vertical-align="middle">
<img src="{{ results.dirurl }}/aa.png" alt="asset allocation">
</td>

<br />

<td width=50%>
<table class="table-lined">
{% for r in results.calc.0.recommend %}
<tr>
<td class="left"> {{ r.name }} </td>
<td class="right"> {% if r.npv == None %} - {% else %} {{ r.npv }} {% endif %} </td>
<td class="right"> {% if r.alloc == None %} - {% else %} {{ r.alloc }}% {% endif %} </td>
</tr>
{% endfor %}
<tr>
<th align="left"> Total </th>
<th align="right"> {{ results.calc.0.npv_total_all }} </th>
<th align="right"> {{ results.calc.0.alloc_total_pct }}% </th>
</tr>
</table>
</td>

</tr>

</table>

</div>

<br />

{% if mode == 'number' %}

For your desired consumption level you need to have a total of
{{ results.calc.0.npv_display.nv_taxable }} today excluding defined benefits.
An {{ alloc_form.cleaned_data.confidence_pct }}% confidence interval
on this recommendation is {{ results.calc.2.npv_display.nv_taxable }} to
{{ results.calc.1.npv_display.nv_taxable }}.
<div class="small">
The amount you would require in the future will be larger; if you had
this amount today it would be invested and growing. Uncertainty in
this amount is the result of inherent uncertainty in the expected
return of stocks compounded over time.
</div>

<br />

{% elif mode == 'retire' %}
For your desired consumption level you should be able to retire at age
{{ results.calc.0.retirement_age }}.  An
{{ alloc_form.cleaned_data.confidence_pct }}% confidence interval on
this recommendation is {{ results.calc.2.retirement_age }} to
{{ results.calc.1.retirement_age }}.
<div class="small">
Uncertainty in this age is the result of inherent uncertainty in the
expected return of stocks compounded over time.
</div>

<br />
{% endif %}

{% if alloc_form.cleaned_data.mortgage > 0 %}

{% if alloc_form.cleaned_data.p > 0 %}

Caution: You have both taxable retirement savings and a mortgage. We
recommend using the taxable savings to pay off the mortgage, although
the results we provide here assume you elect not to do so.

<br />
<br />

{% endif %}

{% endif %}

{% if results.present.using_reverse_mortgage %}

  {% if not alloc_form.cleaned_data.have_rm %}

    We recommend obtaining a reverse mortgage at age

    {% if results.present.rm_tenure %}

      {{ results.present.tenure_age }}.

    {% else %}

      {{ results.present.rm_purchase_age }}.

    {% endif %}

  {% endif %}

  {% if results.present.rm_tenure %}

    We then recommend immediately taking the reverse mortgage periodic
    payout tenure option.

  {% else %}

    {% if alloc_form.cleaned_data.have_rm %}

      We recommend immediately

    {% elif results.present.rm_purchase_age == results.present.credit_line_age %}

      We then recommend immediately

    {% else %}

      We recommend allowing a line of credit to build up on the reverse
      mortgage until age {{ results.present.credit_line_age }}, and then

    {% endif %}

    fully utilizing the reverse mortgage line of credit.

  {% endif %}

<br />

{% elif alloc_form.cleaned_data.use_rm %}

We do not recommend using a reverse mortgage.

<br />
<br />

{% endif %}

{% if results.calc.0.annuitize_plan %}

We recommend purchasing a
{% if alloc_form.cleaned_data.age < alloc_form.cleaned_data.retirement_age %}
deferred income annuity
{% else %}
single premium immediate annuity
{% endif %}
of {{ results.calc.0.purchase_income_annuity }}.
This is estimated to increase your annual consumption by {{ results.calc.0.annuitize_gain }}
versus never doing so.
<div class="small">
We roughly estimate the cost of delaying this purchase by one year as
{{ results.calc.0.annuitize_delay_cost }} in aggregate consumption
over your lifetime.  We recommend the income annuity be inflation
indexed. Do not purchase a variable annuity.
{% if alloc_form.cleaned_data.age < alloc_form.cleaned_data.retirement_age %}
{% endif %}
The consumption recommendations made below factor in the purchase of
this income annuity.
</div>

<br />

{% elif alloc_form.cleaned_data.purchase_income_annuity %}

We do not recommend you purchase an income annuity at the present
time.

<br />
<br />

{% endif %}

We recommend adopting a
<!-- healthcheck_aa --> {{ results.calc.0.aa_equity_pct }}/{{ results.calc.0.aa_bonds_pct }}
stock/bond asset allocation.
<div class="small">
Asset allocation is between stocks and regular bonds plus liability
matching bonds. For many scenarios a stock heavy asset allocation is
appropriate because defined benefits are in many ways similar to
bonds.
Stock holdings should be diversified. At least 20 different
stocks. Preferably many more. Such diversification can be obtained
using a low cost index fund.
Regular bond holdings are nominal and should also be diversified.
Again an index fund suffices.
Liability matching bonds should be inflation indexed and have a
duration of about {{ results.calc.0.lm_bonds_duration }} years.
</div>

<br />

With about {{ alloc_form.cleaned_data.confidence_pct }}% confidence
the proportion of stocks recommended is in the range
{{ results.calc.1.aa_equity_pct }}% to {{ results.calc.2.aa_equity_pct }}%.
<div class="small">
This range can be very large as a result of intrinsic uncertainty in
the expected premium of equities over bonds given only about 100 years
of historical data and a high volatility. For more details see
<a href="http://ssrn.com/abstract=2675390">Asset Allocation Confidence
Intervals in Retirement</a>.
For confidence intervals in excess of about 95% the computed
lower bound will be lower than it should be. This is because demand
side effects mean we can be confident the return for equities exceeds
that of bonds.
</div>

<br />

{% if mode == 'aa' %}

The amount you should consume during retirement varies from year to
year. Currently it is recommended
you should consume around <!-- healthcheck_consume --> {{ results.calc.0.consume }}
after tax and after mortgage payments per year when fully retired.
An {{ alloc_form.cleaned_data.confidence_pct }}% confidence interval
on this recommendation is {{ results.calc.1.consume }} to
{{ results.calc.2.consume }}.

<br />
<br />

{% endif %}

Caution: We have not performed a cash flow analysis to determine if
you will always have the liquid assets you need, when you need them,
in order to fund the above consumption.

<br />
<br />

The annual volatility of your investment portfolio is estimated to be
{{ results.calc.0.investments_vol_pct }}%.  The annual volatility of
your total portfolio, and hence your recommended consumption, is estimated to be
{{ results.calc.0.total_vol_pct }}%.

<br />
<br />

<div style="clear: both;"></div>

<div class="advanced_controller">
Show calculations: {{ alloc_form.advanced_calculations }}
{{ alloc_form.advanced_calculations.errors }}
</div>

<div class="advanced">

<h2>Common calculations</h2>

<div class="indent">

Yield curve date: {{ results.yield_curve_date }}.

<br />
<br />

Net present value table:

<table class="table-lined center">
<tr>
<td> </td>
<td> Owner </td>
<td> Net present value
<div class="small">
real interest rate adjusted
</div>
</td>
</tr>
{% for db in results.db %}
<tr>
<td class="left"> {{ db.present.description }} </td>
<td> {{ db.present.who }} </td>
<td class="right"> {{ db.present.nv }} </td>
</tr>
{% endfor %}
<tr>
<td class="left"> Total defined benefits </td>
<th colspan=2 class="right"> {{ results.present.nv_db }} </th>
</tr>
{% if mode != 'number' %}
<tr>
<td class="left"> Pre-tax traditional </td>
<td colspan=2 class="right"> {{ results.present.nv_traditional }} </td>
</tr>
<tr>
<td class="left"> After tax Roth </td>
<td colspan=2 class="right"> {{ results.present.nv_roth }} </td>
</tr>
<tr>
<td class="left"> Taxable </td>
<td colspan=2 class="right"> {{ results.present.nv_taxable }} </td>
</tr>
{% endif %}
<tr>
<td class="left"> Total investments </td>
<th colspan=2 class="right"> {{ results.present.nv_investments }} </th>
</tr>
<tr>
<td class="left"> Home </td>
<td colspan=2 class="right"> {{ results.present.nv_home }} </td>
</tr>
<tr>
<td class="left">
Mortgage
<div class="small">
Paid off in {{ results.present.mortgage_payoff_years }} years.
Cost {{ results.present.nv_mortgage_payoff }}.
</div>
</td>
<td colspan=2 class="right"> {{ results.present.nv_mortgage }} </td>
</tr>
<tr>
<td class="left">
Reverse mortgage credit line of {{ results.present.credit_line }}
<div class="small">
Obtained at age {{ results.present.rm_purchase_age }}.
Utilized at age {{ results.present.credit_line_age }}.
</div>
</td>
<td colspan=2 class="right"> {{ results.present.nv_credit_line }} </td>
</tr>
<tr>
<td class="left">
Or reverse mortgage annual tenure of {{ results.present.tenure }}
<div class="small">
Obtained at age {{ results.present.tenure_age }}.
</div>
 </td>
<td colspan=2 class="right"> {{ results.present.nv_tenure }} </td>
</tr>
<tr>
<td class="left">
Available home equity after mortgage payoff
</td>
<td colspan=2 class="right"> {{ results.present.nv_available_home }} </td>
</tr>
<tr>
<td class="left"> Home equity to be used </td>
<th colspan=2 class="right"> {{ results.present.nv_utilized_home }} </th>
</tr>
{% if mode != 'number' %}
<tr>
<td class="left"> Future contributions </td>
<th colspan=2 class="right"> {{ results.present.nv_contributions }} </th>
</tr>
{% endif %}
<tr>
<td class="left"> Total net present value </td>
<th colspan=2 class="right"> {{ results.present.nv }} </th>
</tr>
<tr>
<tr>
<td colspan=4 class="left small">
Computed from mortality table and real yield curve.
<br />
Future contributions includes mortgage payments and is first applied
to the mortgage.
</td>
</tr>
</table>

<br />

Years until retirement: {{ results.pre_retirement_years }}
<br />
Retirement additional life expectancy: {{ results.calc.0.retirement_life_expectancy }} years
<br />
Liability matching bonds expected arithmetic real return: {{ results.calc.0.lm_bonds_ret_pct }}%
<br />
Macaulay duration: {{ results.calc.0.lm_bonds_duration }} years
<div class="small">
Computed from mortality table and real yield curve assuming level
consumption requirements except when one party is deceased.
</div>

</div>

{% for calc in results.calc %}

<h2>{{ calc.description }}</h2>

<div class="indent">

Arithmetic real return on equities: {{ calc.equity_am_pct }}% Regular bonds: {{ calc.bonds_am_pct }}%
<br />
Geometric real return on equities: {{ calc.equity_gm_pct }}% Regular bonds: {{ calc.bonds_gm_pct }}%

<br />
<br />

{% if mode == 'number' %}

We tried a number of different portfolio sizes. Here are the results
for the portfolio size that gives close to the desired level of consumption:

<br />
<br />

Total portfolio value excluding defined benefits: {{ calc.npv_display.nv_investments }}

<br />
<br />

{% elif mode == 'retire' %}

We tried a number of different retirement ages. Here are the results
for the first retirement age that meets the desired level of
consumption:

<br />
<br />

Retirement age: {{ calc.retirement_age }}

<br />
<br />

{% endif %}

Merton's formula gives the following recommended asset allocation:

<table class="table-lined center">
{% for w in calc.w %}
<tr>
<td class="left"> {{ w.name }} </td>
<td class="right"> {{ w.alloc }}% </td>
</tr>
{% endfor %}
<tr>
<td colspan=2 class="small left">
Computed assuming liability matching bonds, future contributions,
defined benefits, and home equity are risk free using the matrix
<br /> version
of <a href="https://en.wikipedia.org/wiki/Merton's_portfolio_problem">Merton's
formula</a>. The volatility of future contributions and the returns
and volatility of home equity may differ somewhat from this
assumption.
</td>
</tr>
</table>

<br />

Don't be alarmed by negative values or values greater than 100% in the table above.
We will eliminate them later.

<br />
<br />

Adjusting the recommended asset allocation for

{% if mode != 'number' %}
future contributions and
{% endif %}

defined benefits gives:

<table class="table-lined center">
{% for w in calc.w_prime %}
<tr>
<td class="left"> {{ w.name }} </td>
<td class="right"> {{ w.alloc }}% </td>
</tr>
{% endfor %}
{% if mode == 'number' %}
<tr>
<td colspan=2 class="small">
Computed assuming liability matching bonds, defined benefits, and home
equity are risk free using the matrix
<br />
version
of <a href="https://en.wikipedia.org/wiki/Merton's_portfolio_problem">Merton's
formula</a>. The returns and volatility of home equity may differ
somewhat from this assumption.
</td>
{% endif %}
</table>

{% if calc.annuitize_plan %}

<br />

Recommended annuitization ratios:
Stocks {{ calc.annuitize_equity_pct }}%. Regular bonds {{ calc.annuitize_bonds_pct }}%. Liability matching bonds {{ calc.annuitize_lm_bonds_pct }}%.
<div class="small">
The advantages of annuitizing the stock portion of a portfolio at
advanced ages are well understood. What isn't well known is that there
are advantages to annuitizing the fixed income portion of a portfolio
at earlier ages. For details see
<a href="{% url 'docs' 'when_to_annuitize' %}">When to Annuitize</a>.
The ratios above are the proportion of each portfolio
holding type that we recommend be annuitized.
</div>

{% endif %}

<br />

Adjusting for any income annuity
purchases, home equity, the substitution of regular bonds for liability matching
bonds, and the possibility of winning or losing the game, produces the
following recommendations.

<table class="table-lined center">
<tr>
<td> </td>
<td> Recommended allocation </td>
<td> Expected return
<div class="small">
Inflation adjusted.
</div>
</td>
<td> Short-term volatility </td>
<td> Liability matching volatility </td>
</tr>
{% for r in calc.recommend %}
<tr>
<td class="left"> {{ r.name }} </td>
<td class="right"> {% if r.alloc == None %} - {% else %} {{ r.alloc }}% {% endif %} </td>
<td class="right"> {% if r.ret == None %} - {% else %} {{ r.ret }}% {% endif %} </td>
<td class="right"> {% if r.vol == None %} - {% else %} {{ r.vol }}% {% endif %} </td>
<td class="right"> {% if r.lm_vol == None %} - {% else %} {{ r.lm_vol }}% {% endif %} </td>
</tr>
{% endfor %}
<tr>
<th class="left" rowspan=2> Investments </th>
<th class="right" rowspan=2> {{ calc.alloc_investments_pct }}% </th>
<th class="right"> arithmetic {{ calc.investments_ret_pct }}% </th>
<th class="right" rowspan=2> {{ calc.investments_vol_pct }}% </th>
<td class="right" rowspan=2> - </td>
</tr>
<tr>
<th class="right"> geometric {{ calc.investments_geometric_ret_pct }}% </th>
</tr>
<tr>
<th class="left" rowspan=2> Total </th>
<th class="right" rowspan=2> {{ calc.alloc_total_pct }}% </th>
<th class="right"> arithmetic {{ calc.total_ret_pct }}% </th>
<td class="right" rowspan=2> - </td>
<th class="right" rowspan=2> {{ calc.total_vol_pct }}% </th>
</tr>
<tr>
<th class="right"> geometric {{ calc.total_geometric_ret_pct }}% </th>
</tr>
</table>

<div class="small">
We assume regular bonds are closest to liability matching bonds and
defined benefits, and reduce the former to make up for any need to
increase the latter. We assume home equity is not correlated with any
of the other asset classes. We assume the liability matching
volatility of future nominal amounts, or the volatility of the
inflation rate, is zero. In doing so we note that volatility is a poor
measure of the risk associated with inflation.
</div>

<br />

Estimated {{ calc.loss_pctl_pct }}th percentile annual real investment portfolio decline: {{ calc.investments_loss_pct }}%
<br />
Estimated {{ calc.loss_pctl_pct }}th percentile annual liability matching total portfolio decline: {{ calc.total_loss_pct }}%

<br />
<br />

Recommended annual retirement consumption amount without annuitization: {{ calc.consume_unannuitize }}
{% if alloc_form.cleaned_data.purchase_income_annuity %}
<br/>
Recommended annual retirement consumption amount with annuitization: {{ calc.consume_annuitize }}
{% endif %}
<div class="small">
Estimate based on rules of thumb that break down at advanced ages.
</div>

{% if alloc_form.cleaned_data.purchase_income_annuity %}

<br />

Potential income annuity purchase amount: {{ calc.purchase_income_annuity }}

<br />

Estimated lifetime cost of delaying purchase of income annuity by one year: {{ calc.annuitize_delay_cost }}

<br />

{% endif %}

<br />

Investment stock/bond asset allocation: {{ calc.aa_equity_pct }}/{{ calc.aa_bonds_pct }}

</div>

{% endfor %}

</div>
</div>
</div>

<!-- Blank space so calculations start to become visible when click show calculations. -->
<br />
<br />

{% endif %}

</form>

{% endblock %}
